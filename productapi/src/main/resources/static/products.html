<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      background: #f8f9fa;
    }
    .navbar {
      border-radius: 0;
    }
    .card {
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    .table th {
      background-color: #f1f3f6;
    }
  </style>
</head>
<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="#">Product Manager</a>
      <button class="btn btn-light ms-auto" data-bs-toggle="modal" data-bs-target="#productModal">
        <i class="fa fa-plus"></i> Add Product
      </button>
    </div>
  </nav>

  <!-- Main Container -->
  <div class="container my-4">
    <div class="card p-3">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="fw-bold">Product List</h5>
        <input type="text" id="searchBox" class="form-control w-25" placeholder="Search...">
      </div>

      <div class="table-responsive">
        <table class="table table-striped align-middle">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Category</th>
              <th>Price ($)</th>
              <th class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody id="productTableBody">
            <!-- Products will load here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal for Add/Edit -->
  <div class="modal fade" id="productModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content rounded-4 shadow">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitle">Add Product</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form id="productForm">
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Product ID</label>
              <input type="number" class="form-control" id="productId" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Name</label>
              <input type="text" class="form-control" id="productName" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Category</label>
              <select id="productCategory" class="form-select" required>
                <option value="">Select Category</option>
                <option>Electronics</option>
                <option>Fashion</option>
                <option>Grocery</option>
                <option>Books</option>
                <option>Other</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Price ($)</label>
              <input type="number" class="form-control" id="productPrice" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-success">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Bootstrap + JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const API_URL = "/api/products";
    const productTableBody = document.getElementById("productTableBody");
    const productForm = document.getElementById("productForm");
    const modalTitle = document.getElementById("modalTitle");
    const productModal = new bootstrap.Modal(document.getElementById("productModal"));
    const searchBox = document.getElementById("searchBox");

    let productsCache = [];

    // Load products
    async function fetchProducts() {
      const res = await fetch(API_URL);
      productsCache = await res.json();
      renderProducts(productsCache);
    }

    // Render product rows
    function renderProducts(products) {
      productTableBody.innerHTML = "";
      products.forEach(p => {
        productTableBody.innerHTML += `
          <tr>
            <td>${p.id}</td>
            <td>${p.name}</td>
            <td>${p.category}</td>
            <td>$${p.price.toFixed(2)}</td>
            <td class="text-center">
              <button class="btn btn-sm btn-outline-primary me-2" onclick="editProduct(${p.id})"><i class="fa fa-edit"></i></button>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct(${p.id})"><i class="fa fa-trash"></i></button>
            </td>
          </tr>
        `;
      });
    }

    // Search filter
    searchBox.addEventListener("input", () => {
      const query = searchBox.value.toLowerCase();
      const filtered = productsCache.filter(p =>
        p.name.toLowerCase().includes(query) ||
        p.category.toLowerCase().includes(query) ||
        p.id.toString().includes(query)
      );
      renderProducts(filtered);
    });

    // Add/Edit product
    productForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = parseInt(document.getElementById("productId").value);
      const product = {
        id,
        name: document.getElementById("productName").value,
        category: document.getElementById("productCategory").value,
        price: parseFloat(document.getElementById("productPrice").value)
      };

      const existing = productsCache.find(p => p.id === id);
      if (existing) {
        await fetch(API_URL + '/' + id, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(product)
        });
      } else {
        await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(product)
        });
      }

      productForm.reset();
      modalTitle.innerText = "Add Product";
      productModal.hide();
      fetchProducts();
    });

    // Edit
    function editProduct(id) {
      const product = productsCache.find(p => p.id === id);
      if (!product) return;
      document.getElementById("productId").value = product.id;
      document.getElementById("productName").value = product.name;
      document.getElementById("productCategory").value = product.category;
      document.getElementById("productPrice").value = product.price;
      modalTitle.innerText = "Edit Product";
      productModal.show();
    }

    // Delete
    async function deleteProduct(id) {
      if (!confirm("Are you sure you want to delete this product?")) return;
      await fetch(API_URL + '/' + id, { method: 'DELETE' });
      fetchProducts();
    }

    // Initial load
    fetchProducts();
  </script>
</body>
</html>
